<!--
Copyright (c) 2025 LuminaPJ
SM2 Key Generator is licensed under Mulan PSL v2.
You can use this software according to the terms and conditions of the Mulan PSL v2.
You may obtain a copy of Mulan PSL v2 at:
         http://license.coscl.org.cn/MulanPSL2
THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
See the Mulan PSL v2 for more details.
-->
<wxs module="utils" src="../../utils/CommonUtil.wxs"></wxs>

<error-popup bind:visible-change="errorVisibleChange" message="{{errorMessage}}" visible="{{errorVisible}}"/>

<t-navbar t-class-content="t-navbar-content" t-class-placeholder="t-navbar-placeholder">
    <view class="title" slot="left">我</view>
</t-navbar>

<t-pull-down-refresh bind:refresh="onRefresh" enable-passive enhanced
                     loadingTexts="{{['下拉刷新', '松手刷新', '', '加载完成']}}"
                     scroll-with-animation scroll-y="{{true}}" show-scrollbar="{{false}}"
                     style="height: {{scrollHeightPx-56}}px;" usingCustomNavbar
                     value="{{isRefreshing}}">
    <view class="pt-96rpx mx-32rpx" wx:if="{{!isRefreshing&&!utils.isLogin(jwt)}}">
        <t-result theme="default" title="尚未登录"/>
        <t-button bind:tap="login" block class="mt-32rpx" size="large" theme="primary">登录</t-button>
    </view>

    <view class="pt-32rpx" wx:if="{{utils.isLogin(jwt)}}">
        <t-cell-group theme="card">
            <t-cell align="top" bordered="{{false}}"
                    description="{{groupInfo.length===0?'尚未加入任何团体':'已加入 '+groupInfo.length+' 个团体'}}"
                    hover>
                <view slot="title">
                    <view class="mr-16rpx inline">{{userInfo.userId === '' ? '琳琅问新用户' : userInfo.userName}}</view>
                    <t-tag class="inline-block vertical-bottom" theme="default" variant="light"
                           wx:if="{{userInfo.userId!==''}}">
                        {{userInfo.userId}}
                    </t-tag>
                </view>
            </t-cell>
        </t-cell-group>
    </view>

    <view class="mt-32rpx pb-32rpx">
        <t-cell-group theme="card">
            <t-cell arrow bind:click="clickGroupManagement" bordered hover leftIcon="user-setting" title="团体管理"/>
            <t-cell arrow bind:click="clickSetting" bordered hover leftIcon="setting" title="设置"/>
            <t-cell arrow bind:click="clickAbout" bordered="{{false}}" hover leftIcon="info-circle" title="关于">
                <t-badge dot slot="note"
                         wx:if="{{isShowUserAgreementBadge||isShowPrivacyPolicyBadge||isShowPersonalInformationCollectionListBadge||isShowThirdPartyPersonalInformationSharingListBadge}}"/>
            </t-cell>
        </t-cell-group>
    </view>
</t-pull-down-refresh>